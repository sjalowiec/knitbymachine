---
import BaseLayout from "../../layouts/BaseLayout.astro";
import ActionBar from "../../components/wizards/ActionBar.astro";
---

<BaseLayout 
  title="Maximum Knitted Width | Knit by Machine" 
  description="Calculate the widest piece you can knit on your machine based on your available needles and stitch gauge.">

<style>
.wizard-page {
  padding-top: 120px;
  padding-bottom: 3rem;
  min-height: 100vh;
  background: var(--page-bg);
}

.page-header {
  text-align: center;
  max-width: 800px;
  margin: 0 auto 2rem;
  padding: 0 1rem;
}

.page-header h1 {
  color: var(--kbm-green);
  font-size: 2rem;
  font-weight: 700;
  margin-bottom: 0.75rem;
}

.page-header p {
  color: #6b7280;
  font-size: 1.05rem;
  line-height: 1.6;
}

.wizard-container {
  max-width: 900px;
  margin: 0 auto;
  padding: 0 1rem 120px 1rem;
}

.calculator-card {
  background: white;
  padding: 2rem;
  border-radius: 12px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
  margin-bottom: 1.5rem;
}

.section-title {
  color: var(--kbm-green);
  font-size: 1.3rem;
  font-weight: 700;
  margin: 0 0 1.5rem;
  padding-bottom: 0.5rem;
  border-bottom: 2px solid #eef0ea;
}

.slider-section {
  margin-bottom: 2rem;
}

.slider-label {
  font-weight: 600;
  color: #374151;
  margin-bottom: 1rem;
  font-size: 1rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.slider-value {
  color: var(--kbm-green);
  font-size: 1.1rem;
}

.slider-container {
  position: relative;
  padding: 1rem 0;
}

.slider {
  -webkit-appearance: none;
  width: 100%;
  height: 8px;
  border-radius: 5px;
  background: #e5e7eb;
  outline: none;
  transition: all 0.2s;
}

.slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 24px;
  height: 24px;
  border-radius: 50%;
  background: var(--kbm-green);
  cursor: pointer;
  transition: all 0.2s;
}

.slider::-webkit-slider-thumb:hover {
  transform: scale(1.15);
  box-shadow: 0 0 0 8px rgba(82, 104, 45, 0.1);
}

.slider::-moz-range-thumb {
  width: 24px;
  height: 24px;
  border-radius: 50%;
  background: var(--kbm-green);
  cursor: pointer;
  border: none;
  transition: all 0.2s;
}

.slider::-moz-range-thumb:hover {
  transform: scale(1.15);
  box-shadow: 0 0 0 8px rgba(82, 104, 45, 0.1);
}

.tick-marks {
  display: flex;
  justify-content: space-between;
  margin-top: 0.5rem;
  padding: 0 12px;
}

.tick {
  font-size: 0.75rem;
  color: #9ca3af;
  text-align: center;
}

.result-card {
  background: linear-gradient(135deg, rgba(82, 104, 45, 0.15) 0%, rgba(82, 104, 45, 0.08) 100%);
  border: 2px solid var(--kbm-green);
  padding: 1.5rem;
  border-radius: 12px;
  text-align: center;
}

.result-text {
  font-size: 1.1rem;
  line-height: 1.6;
  color: #2d3748;
  margin-bottom: 1.5rem;
}

.result-text strong {
  color: var(--kbm-green);
  font-weight: 700;
}

.ruler-wrapper {
  margin-top: 1.5rem;
  width: 100%;
  max-width: 500px;
  margin-left: auto;
  margin-right: auto;
}

.ruler-label {
  font-size: 0.85rem;
  color: #6b7280;
  margin-bottom: 0.5rem;
  text-align: left;
}

@media (max-width: 640px) {
  .page-header h1 {
    font-size: 1.5rem;
  }
  
  .calculator-card {
    padding: 1.5rem;
  }
  
  .result-text {
    font-size: 1rem;
  }
}
</style>

<div class="wizard-page">
  <div class="page-header">
    <h1>Maximum Knitted Width</h1>
    <p>See how wide you can knit on your machine based on your available needles and stitch gauge.</p>
  </div>

  <div class="wizard-container">
    <div class="calculator-card">
      <h2 class="section-title">Calculate Your Maximum Width</h2>
      
      <!-- Needle Count Slider -->
      <div class="slider-section">
        <div class="slider-label">
          <span>How many needles do you have?</span>
          <span class="slider-value" id="needle-value">150 needles</span>
        </div>
        <div class="slider-container">
          <input 
            type="range" 
            class="slider" 
            id="needle-slider" 
            min="0" 
            max="4" 
            value="2" 
            step="1"
          />
          <div class="tick-marks">
            <span class="tick">100</span>
            <span class="tick">110</span>
            <span class="tick">150</span>
            <span class="tick">200</span>
            <span class="tick">272</span>
          </div>
        </div>
      </div>

      <!-- Gauge Slider -->
      <div class="slider-section">
        <div class="slider-label">
          <span>Stitch gauge (stitches per 10 cm / 4″)</span>
          <span class="slider-value" id="gauge-value">16.0 sts / 10 cm</span>
        </div>
        <div class="slider-container">
          <input 
            type="range" 
            class="slider" 
            id="gauge-slider" 
            min="8" 
            max="40" 
            value="16" 
            step="0.1"
          />
        </div>
      </div>
    </div>

    <!-- Results -->
    <div class="result-card" id="result-card">
      <div class="result-text" id="result-text">
        Using <strong>150</strong> needles at a gauge of <strong>16.0</strong> sts / 10 cm,<br>
        your maximum knitted width is <strong>37.0″ (93.8 cm)</strong>.
      </div>
      
      <div class="ruler-wrapper">
        <div class="ruler-label">Visual Width Scale (0-100 cm)</div>
        <svg id="ruler-bar" viewBox="0 0 400 30" style="width:100%; height:30px;">
          <defs>
            <linearGradient id="rulerGradient" x1="0" y1="0" x2="1" y2="0">
              <stop offset="0%" stop-color="#52682D" />
              <stop offset="100%" stop-color="#7B9B4A" />
            </linearGradient>
          </defs>
          <!-- Background track -->
          <rect x="0" y="12" width="400" height="6" fill="#ddd" rx="3" />
          <!-- Dynamic fill -->
          <rect id="ruler-fill" x="0" y="12" width="375" height="6" fill="url(#rulerGradient)" rx="3" />
          <!-- Tick marks -->
          <g stroke="#aaa" stroke-width="1">
            <line x1="0" y1="10" x2="0" y2="20"/>
            <line x1="50" y1="10" x2="50" y2="20"/>
            <line x1="100" y1="10" x2="100" y2="20"/>
            <line x1="150" y1="10" x2="150" y2="20"/>
            <line x1="200" y1="10" x2="200" y2="20"/>
            <line x1="250" y1="10" x2="250" y2="20"/>
            <line x1="300" y1="10" x2="300" y2="20"/>
            <line x1="350" y1="10" x2="350" y2="20"/>
            <line x1="400" y1="10" x2="400" y2="20"/>
          </g>
        </svg>
      </div>
    </div>
  </div>
</div>

<ActionBar>
  <button id="start-over-btn" class="action-btn secondary">
    <i class="fa-solid fa-rotate-left"></i>
    Start Over
  </button>
  <button id="print-btn" class="action-btn">
    <i class="fa-solid fa-print"></i>
    Print
  </button>
</ActionBar>

<script>
document.addEventListener('DOMContentLoaded', function() {
  console.log('Maximum Knitted Width Wizard initializing...');
  
  // Needle count snap points
  const needleCounts = [100, 110, 150, 200, 272];
  
  // DOM elements
  const needleSlider = document.getElementById('needle-slider');
  const needleValue = document.getElementById('needle-value');
  const gaugeSlider = document.getElementById('gauge-slider');
  const gaugeValue = document.getElementById('gauge-value');
  const resultText = document.getElementById('result-text');
  const rulerFill = document.getElementById('ruler-fill');
  const startOverBtn = document.getElementById('start-over-btn');
  const printBtn = document.getElementById('print-btn');
  
  // State
  let currentNeedles = 150;
  let currentGauge = 16.0;
  
  // Calculate width
  function calculateWidth(needles, gauge) {
    const widthCm = (needles / gauge) * 10;
    const widthIn = widthCm / 2.54;
    return { widthCm, widthIn };
  }
  
  // Update display
  function updateDisplay() {
    const { widthCm, widthIn } = calculateWidth(currentNeedles, currentGauge);
    
    // Update text
    resultText.innerHTML = `
      Using <strong>${currentNeedles}</strong> needles at a gauge of <strong>${currentGauge.toFixed(1)}</strong> sts / 10 cm,<br>
      your maximum knitted width is <strong>${widthIn.toFixed(1)}″ (${widthCm.toFixed(1)} cm)</strong>.
    `;
    
    // Update ruler bar
    updateRulerBar(widthCm);
  }
  
  // Update ruler bar
  function updateRulerBar(widthCm) {
    const maxCm = 100; // scale reference
    const maxWidth = 400; // SVG width
    const scaledWidth = Math.min((widthCm / maxCm) * maxWidth, maxWidth);
    rulerFill.setAttribute('width', scaledWidth);
  }
  
  // Needle slider handler
  needleSlider.addEventListener('input', function() {
    const index = parseInt(this.value);
    currentNeedles = needleCounts[index];
    needleValue.textContent = `${currentNeedles} needles`;
    updateDisplay();
  });
  
  // Gauge slider handler
  gaugeSlider.addEventListener('input', function() {
    currentGauge = parseFloat(this.value);
    gaugeValue.textContent = `${currentGauge.toFixed(1)} sts / 10 cm`;
    updateDisplay();
  });
  
  // Start over button
  startOverBtn.addEventListener('click', function() {
    needleSlider.value = 2; // 150 needles
    gaugeSlider.value = 16;
    currentNeedles = 150;
    currentGauge = 16.0;
    needleValue.textContent = '150 needles';
    gaugeValue.textContent = '16.0 sts / 10 cm';
    updateDisplay();
  });
  
  // Print button
  printBtn.addEventListener('click', function() {
    window.print();
  });
  
  // Initial display
  updateDisplay();
  
  console.log('Maximum Knitted Width Wizard initialized successfully');
});
</script>

</BaseLayout>
